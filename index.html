<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WB Foto Manager - Galerie</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2a2a2a;
            --bg-tertiary: #333;
            --text-primary: #e0e0e0;
            --text-secondary: #888;
            --accent: #667eea;
            --accent-hover: #764ba2;
            --border: #333;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
        }
        
        body.light-mode {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-tertiary: #e0e0e0;
            --text-primary: #1a1a1a;
            --text-secondary: #666;
            --border: #ddd;
        }
        
        /* Light Mode Anpassungen */
        body.light-mode .gallery-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
        }
        
        body.light-mode .gallery-card:hover {
            border-color: var(--accent);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2);
        }
        
        body.light-mode .gallery-card h3 {
            color: #1a1a1a !important;
            font-weight: 700;
        }
        
        body.light-mode .gallery-card p {
            color: #444;
        }
        
        body.light-mode .gallery-folder-header {
            color: #1a1a1a !important;
            font-weight: 600;
            border-bottom-color: #ddd !important;
        }
        
        /* Weitere Light Mode Verbesserungen */
        body.light-mode h1 {
            -webkit-text-fill-color: #1a1a1a;
            color: #1a1a1a;
        }
        
        body.light-mode .gallery-card {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        body.light-mode .gallery-card:hover {
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
        }
        
        body.light-mode .gallery-card-preview {
            background: #e0e0e0;
        }
        
        body.light-mode .gallery-item {
            background: var(--bg-secondary);
        }
        
        body.light-mode .gallery-item-overlay {
            background: linear-gradient(to bottom, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.05) 50%, rgba(0,0,0,0.3) 100%);
        }
        
        body.light-mode .stat-item {
            background: rgba(102, 126, 234, 0.05);
            border-left-color: var(--accent);
        }
        
        body.light-mode .stat-label {
            color: var(--text-secondary);
        }
        
        body.light-mode .stat-value {
            color: var(--text-primary);
        }
        
        body.light-mode .sidebar-section {
            border-top-color: var(--border);
        }
        
        body.light-mode .flag-summary-item {
            background: rgba(0,0,0,0.05);
        }
        
        body.light-mode .selection-item {
            background: rgba(102, 126, 234, 0.05);
            border-left-color: var(--accent);
        }
        
        body.light-mode .comment-item {
            background: var(--bg-primary);
            border-left-color: var(--accent);
        }
        
        body.light-mode .comment-input {
            background: var(--bg-primary);
            border-color: var(--border);
            color: var(--text-primary);
        }
        
        body.light-mode .breadcrumb-item {
            color: var(--text-secondary);
        }
        
        body.light-mode .breadcrumb-item:hover {
            color: var(--accent);
        }
        
        body.light-mode .breadcrumb-item.active {
            color: var(--text-primary);
        }
        
        body.light-mode .breadcrumb-separator {
            color: var(--text-secondary);
        }
        
        body.light-mode .skeleton {
            background: var(--bg-secondary);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 40px 20px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 40px;
            position: relative;
        }
        
        body.light-mode header {
            border-bottom-color: var(--border);
        }
        
        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid #667eea;
            color: #667eea;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .theme-toggle:hover {
            background: rgba(102, 126, 234, 0.4);
        }
        
        /* Breadcrumb Navigation */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 15px 0;
            margin-bottom: 20px;
            font-size: 0.9em;
            flex-wrap: wrap;
        }
        
        .breadcrumb-item {
            color: #888;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .breadcrumb-item:hover {
            color: #667eea;
        }
        
        .breadcrumb-item.active {
            color: #e0e0e0;
            cursor: default;
        }
        
        .breadcrumb-separator {
            color: #555;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .logo {
            width: 80px;
            height: 80px;
            border-radius: 16px;
            object-fit: contain;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        body.light-mode h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .gallery-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }
        
        .gallery-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 30px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid transparent;
        }
        
        .gallery-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.5);
            border-color: #667eea;
        }
        
        .gallery-card.locked {
            opacity: 0.7;
        }
        
        .gallery-card-preview {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
            background: #1a1a1a;
        }
        
        .gallery-card h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .gallery-card p {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }
        
        .gallery-card .image-count {
            color: var(--accent);
            font-weight: 600;
        }
        
        .gallery-card .lock-icon {
            float: right;
            font-size: 1.2em;
            color: var(--text-secondary);
        }
        
        .password-form {
            max-width: 400px;
            margin: 40px auto;
            padding: 30px;
            background: var(--bg-secondary);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .password-form h2 {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .password-form input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 16px;
        }
        
        .password-form button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .password-form button:hover {
            opacity: 0.9;
        }
        
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-button:hover {
            background: var(--bg-tertiary);
        }
        
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }
        
        .gallery-item {
            position: relative;
            aspect-ratio: 4/3;
            overflow: hidden;
            border-radius: 12px;
            cursor: pointer;
            background: #2a2a2a;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .gallery-item:hover {
            transform: scale(1.03);
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.3);
            z-index: 10;
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .gallery-item:hover img {
            transform: scale(1.1);
        }
        
        /* Overlay - erscheint beim Hover */
        .gallery-item-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.6) 100%);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 12px;
            opacity: 0;
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }
        
        .gallery-item:hover .gallery-item-overlay {
            opacity: 1;
            pointer-events: all;
        }
        
        /* Checkbox oben links */
        .gallery-item-checkbox {
            width: 28px;
            height: 28px;
            border: 2px solid rgba(255,255,255,0.9);
            border-radius: 6px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 18px;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .gallery-item-checkbox:hover {
            background: rgba(102, 126, 234, 0.5);
            border-color: #667eea;
            transform: scale(1.1);
        }
        
        .gallery-item-checkbox.checked {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
        }
        
        .gallery-item.selected {
            outline: 3px solid #667eea;
            outline-offset: -3px;
        }
        
        /* Skeleton Loading Animation */
        .skeleton {
            background: var(--bg-secondary);
            position: relative;
            overflow: hidden;
        }
        
        .skeleton-shimmer {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }
        
        /* Actions unten */
        .gallery-item-actions {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: flex-end;
        }
        
        .gallery-item-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .gallery-item-btn:hover {
            background: rgba(102, 126, 234, 0.8);
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .gallery-item-btn span:first-child {
            font-size: 16px;
        }
        
        .gallery-item-like.active {
            background: rgba(255, 107, 107, 0.8);
            border-color: #ff6b6b;
        }
        
        .gallery-item-like.active:hover {
            background: rgba(255, 107, 107, 1);
        }
        
        /* Badges f√ºr Markierungen */
        .gallery-item-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: white;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            z-index: 5;
        }
        
        .selection-badge {
            position: absolute;
            bottom: 12px;
            left: 12px;
            padding: 8px 14px;
            background: rgba(102, 126, 234, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            font-size: 13px;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            box-shadow: 0 2px 8px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.1);
            z-index: 5;
            white-space: nowrap;
            letter-spacing: 0.3px;
        }
        
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .lightbox.active {
            display: flex;
        }
        
        .lightbox-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }
        
        .lightbox-content img {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
        }
        
        .lightbox-close {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 30px;
            cursor: pointer;
            background: none;
            border: none;
            padding: 10px;
        }
        
        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            padding: 20px;
            cursor: pointer;
            font-size: 24px;
            border-radius: 50%;
        }
        
        .lightbox-prev {
            left: -60px;
        }
        
        .lightbox-next {
            right: -60px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        .error {
            text-align: center;
            padding: 40px;
            color: #ff6b6b;
        }
        
        .download-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .download-btn:hover {
            background: rgba(0,0,0,0.9);
        }
        
        /* Lightbox Sidebar */
        .lightbox-sidebar {
            position: fixed;
            left: -200px;
            top: 0;
            width: 200px;
            min-width: 200px;
            height: 100vh;
            background: linear-gradient(180deg, #1a1a1a 0%, #2a2a2a 100%);
            border-right: 1px solid #333;
            padding: 12px;
            overflow-y: auto;
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1001;
            box-shadow: 4px 0 24px rgba(0,0,0,0.3);
        }
        
        .lightbox-sidebar.open {
            left: 0;
        }
        
        .lightbox-sidebar h3 {
            font-size: 1em;
            margin-bottom: 12px;
            color: #e0e0e0;
            border-bottom: 1px solid #667eea;
            padding-bottom: 6px;
            font-weight: 600;
        }
        
        .lightbox-sidebar h4 {
            font-size: 0.85em;
            margin-bottom: 8px;
            color: #e0e0e0;
            font-weight: 600;
            margin-top: 12px;
        }
        
        .feedback-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #333;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .feedback-section:first-of-type {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }
        
        /* Rating Stars */
        .rating-stars {
            display: flex;
            gap: 4px;
            margin-bottom: 6px;
        }
        
        .star {
            font-size: 18px;
            color: #444;
            cursor: pointer;
            transition: all 0.2s;
            line-height: 1;
        }
        
        .star:hover {
            transform: scale(1.2);
            color: #ffd700;
        }
        
        .star.active {
            color: #ffd700;
        }
        
        /* Flag Buttons */
        .flag-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }
        
        .flag-btn {
            padding: 6px 8px;
            border: 2px solid;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        .flag-btn.red {
            border-color: #ff6b6b;
            color: #ff6b6b;
        }
        
        .flag-btn.red:hover,
        .flag-btn.red.active {
            background: rgba(255, 107, 107, 0.2);
            border-color: #ff6b6b;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }
        
        .flag-btn.yellow {
            border-color: #ffd93d;
            color: #ffd93d;
        }
        
        .flag-btn.yellow:hover,
        .flag-btn.yellow.active {
            background: rgba(255, 217, 61, 0.2);
            border-color: #ffd93d;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 217, 61, 0.3);
        }
        
        .flag-btn.green {
            border-color: #6bcf7f;
            color: #6bcf7f;
        }
        
        .flag-btn.green:hover,
        .flag-btn.green.active {
            background: rgba(107, 207, 127, 0.2);
            border-color: #6bcf7f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(107, 207, 127, 0.3);
        }
        
        .flag-btn.black {
            border-color: #888;
            color: #888;
        }
        
        .flag-btn.black:hover,
        .flag-btn.black.active {
            background: rgba(136, 136, 136, 0.2);
            border-color: #aaa;
            color: #aaa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(136, 136, 136, 0.3);
        }
        
        /* Comment Input */
        .comment-input {
            width: 100%;
            padding: 6px 8px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 12px;
            font-family: inherit;
            resize: vertical;
            min-height: 50px;
            margin-bottom: 6px;
            transition: border-color 0.2s;
        }
        
        .comment-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        /* Comment List */
        .comment-list {
            margin-top: 8px;
        }
        
        .comment-item {
            background: #1a1a1a;
            padding: 6px 8px;
            border-radius: 4px;
            margin-bottom: 6px;
            border-left: 2px solid #667eea;
        }
        
        .comment-author {
            font-weight: 600;
            color: #667eea;
            font-size: 0.8em;
            margin-bottom: 3px;
        }
        
        .comment-text {
            color: #e0e0e0;
            font-size: 0.85em;
            line-height: 1.3;
            margin-bottom: 3px;
        }
        
        .comment-date {
            color: #888;
            font-size: 0.7em;
        }
        
        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #2a2a2a;
            color: #e0e0e0;
            border: 1px solid #444;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-secondary:hover {
            background: #333;
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        /* Favorit Button in Lightbox */
        #favorite-btn {
            background: rgba(0,0,0,0.6) !important;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2) !important;
            color: #ffffff !important;
            padding: 6px 8px !important;
            font-size: 12px !important;
        }
        
        #favorite-btn.active {
            background: rgba(255, 107, 107, 0.8) !important;
            border-color: #ff6b6b !important;
            color: #ffffff !important;
        }
        
        #favorite-btn:hover {
            background: rgba(102, 126, 234, 0.8) !important;
            border-color: #667eea !important;
        }
        
        #favorite-btn.active:hover {
            background: rgba(255, 107, 107, 1) !important;
        }
        
        #favorite-text {
            color: #ffffff !important;
            font-size: 0.85em !important;
        }
        
        /* Current Selections in Lightbox */
        #current-selections {
            font-size: 0.8em !important;
            color: #e0e0e0 !important;
            margin-top: 8px !important;
        }
        
        #current-selections span {
            background: rgba(102, 126, 234, 0.3) !important;
            color: #ffffff !important;
            padding: 4px 8px !important;
            border-radius: 4px !important;
            margin-right: 5px !important;
            margin-bottom: 5px !important;
            display: inline-block !important;
            font-size: 0.8em !important;
            font-weight: 500 !important;
            border: 1px solid rgba(102, 126, 234, 0.5) !important;
        }
        
        /* Gallery Sidebar (f√ºr √úbersicht) */
        .gallery-sidebar {
            position: relative;
            width: 200px;
            min-width: 200px;
            background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            border-right: 1px solid var(--border);
            padding: 12px;
            overflow-y: auto;
            max-height: calc(100vh - 150px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 4px 0 24px rgba(0,0,0,0.3);
        }
        
        .gallery-sidebar.collapsed {
            width: 40px;
            min-width: 40px;
            padding: 12px 8px;
        }
        
        .gallery-sidebar.collapsed .sidebar-content {
            display: none;
        }
        
        .sidebar-toggle {
            position: absolute;
            top: 12px;
            left: 8px;
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid #667eea;
            color: #667eea;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s;
            z-index: 10;
        }
        
        .sidebar-toggle:hover {
            background: rgba(102, 126, 234, 0.4);
            transform: scale(1.1);
        }
        
        .gallery-sidebar.collapsed .sidebar-toggle {
            left: 8px;
        }
        
        /* Clickable items */
        .clickable {
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .clickable:hover {
            background: rgba(102, 126, 234, 0.2) !important;
            transform: translateX(2px);
        }
        
        .clickable.active {
            background: rgba(102, 126, 234, 0.3) !important;
            border-left-color: #667eea !important;
            border-left-width: 3px !important;
        }
        
        .sidebar-content h3 {
            font-size: 1em;
            margin-bottom: 12px;
            color: #e0e0e0;
            border-bottom: 1px solid #667eea;
            padding-bottom: 6px;
            font-weight: 600;
        }
        
        .sidebar-content h4 {
            font-size: 0.85em;
            margin-bottom: 8px;
            color: #e0e0e0;
            font-weight: 600;
            margin-top: 12px;
        }
        
        .sidebar-stats {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 4px;
            border-left: 2px solid #667eea;
        }
        
        .stat-label {
            color: #aaa;
            font-size: 0.75em;
        }
        
        .stat-value {
            color: #e0e0e0;
            font-weight: 700;
            font-size: 0.9em;
        }
        
        .sidebar-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #333;
        }
        
        .flag-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }
        
        .flag-summary-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
        }
        
        .flag-badge {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .flag-badge.red {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }
        
        .flag-badge.yellow {
            background: rgba(255, 217, 61, 0.2);
            color: #ffd93d;
        }
        
        .flag-badge.green {
            background: rgba(107, 207, 127, 0.2);
            color: #6bcf7f;
        }
        
        .flag-badge.black {
            background: rgba(136, 136, 136, 0.2);
            color: #aaa;
        }
        
        .flag-count {
            color: #e0e0e0;
            font-weight: 600;
            font-size: 0.85em;
        }
        
        .selections-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .selection-item {
            padding: 6px 8px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 4px;
            border-left: 2px solid #667eea;
            color: #ffffff;
            font-size: 0.8em;
            font-weight: 500;
            margin-bottom: 4px;
            line-height: 1.3;
        }
        
        .selection-item.clickable:hover {
            background: rgba(102, 126, 234, 0.2) !important;
            color: #ffffff !important;
        }
        
        .selection-item.clickable.active {
            background: rgba(102, 126, 234, 0.5) !important;
            border-left-width: 3px !important;
            color: #ffffff !important;
            font-weight: 600;
        }
        
        .selection-item span {
            color: #ffffff !important;
            font-weight: 600;
        }
        
        @media (max-width: 1200px) {
            .gallery-sidebar {
                width: 180px;
                min-width: 180px;
            }
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .container {
                padding: 15px;
            }
            
            .gallery {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 20px 10px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .logo {
                width: 60px;
                height: 60px;
            }
            
            .theme-toggle {
                top: 10px;
                right: 10px;
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .gallery-selector {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 15px;
            }
            
            .gallery-card {
                padding: 20px;
            }
            
            .gallery {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 10px;
            }
            
            .gallery-item {
                border-radius: 8px;
            }
            
            .lightbox-nav {
                padding: 12px;
                font-size: 18px;
            }
            
            .lightbox-prev {
                left: 10px;
            }
            
            .lightbox-next {
                right: 10px;
            }
            
            .logo-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .gallery-sidebar {
                position: fixed;
                left: -200px;
                top: 0;
                height: 100vh;
                z-index: 999;
                max-height: 100vh;
                width: 200px;
            }
            
            .gallery-sidebar.open {
                left: 0;
            }
            
            #gallery-container > div {
                flex-direction: column;
            }
            
            .breadcrumb {
                font-size: 0.8em;
                padding: 10px 0;
            }
            
            .lightbox-sidebar {
                width: 100%;
                max-width: 100%;
            }
            
            .lightbox-content {
                max-width: 95%;
            }
        }
        
        @media (max-width: 480px) {
            .gallery {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 8px;
            }
            
            .gallery-selector {
                grid-template-columns: 1fr;
            }
            
            .gallery-card-preview {
                height: 150px;
            }
        }
        
        /* Touch Gestures f√ºr Mobile */
        @media (hover: none) and (pointer: coarse) {
            .gallery-item-overlay {
                opacity: 1;
                pointer-events: all;
            }
            
            .gallery-item-btn {
                padding: 10px 12px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle" title="Dark/Light Mode wechseln">
                <span id="theme-icon">üåô</span>
            </button>
            <div class="logo-container">
                <img src="./logo.png" alt="WB Foto Manager Logo" class="logo">
                <div>
                    <h1>WB Foto Manager</h1>
                    <p>Galerie</p>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <a href="admin.html" style="color: var(--accent); text-decoration: none; font-size: 0.9em;">‚öôÔ∏è Admin</a>
            </div>
        </header>
        
        <!-- Galerie-Auswahl (wird angezeigt wenn mehrere Galerien vorhanden) -->
        <div id="gallery-selector" style="display: none;">
            <div class="gallery-selector" id="gallery-list"></div>
        </div>
        
        <!-- Passwort-Formular -->
        <div id="password-form" class="password-form" style="display: none;">
            <h2>Passwort erforderlich</h2>
            <p style="text-align: center; color: #888; margin-bottom: 20px;" id="gallery-name-display"></p>
            <input type="password" id="password-input" placeholder="Passwort eingeben" autofocus>
            <button onclick="checkPassword()">Anmelden</button>
            <p id="password-error" style="color: #ff6b6b; margin-top: 10px; display: none;">Falsches Passwort</p>
        </div>
        
        <!-- Galerie-Ansicht -->
        <div id="gallery-container" style="display: none;">
            <button class="back-button" onclick="showGallerySelector()" id="back-button" style="display: none;">
                ‚Üê Zur√ºck zur Galerie-Auswahl
            </button>
            <div style="display: flex; gap: 20px;">
                <!-- Sidebar f√ºr Galerie-√úbersicht -->
                <div class="gallery-sidebar" id="gallery-sidebar">
                    <button class="sidebar-toggle" onclick="toggleGallerySidebar()" id="sidebar-toggle-btn">
                        <span id="sidebar-toggle-icon">‚ñ∂</span>
                    </button>
                    <div class="sidebar-content" id="sidebar-content">
                        <h3>üìä √úbersicht</h3>
                        
                        <!-- Suche -->
                        <div class="sidebar-section" style="margin-top: 0; padding-top: 0; border-top: none;">
                            <input type="text" id="search-input" placeholder="üîç Suchen..." style="width: 100%; padding: 6px 8px; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-size: 12px; margin-bottom: 12px;">
                        </div>
                        
                        <div class="sidebar-stats">
                            <div class="stat-item clickable" onclick="filterByType('all')" title="Alle Bilder anzeigen">
                                <span class="stat-label">Gesamt:</span>
                                <span class="stat-value" id="stat-total">0</span>
                            </div>
                            <div class="stat-item clickable" onclick="filterByType('selected')" title="Nur ausgew√§hlte Bilder">
                                <span class="stat-label">Ausgew√§hlt:</span>
                                <span class="stat-value" id="stat-selected">0</span>
                            </div>
                            <div class="stat-item clickable" onclick="filterByType('favorites')" title="Nur Favoriten">
                                <span class="stat-label">Favoriten:</span>
                                <span class="stat-value" id="stat-favorites">0</span>
                            </div>
                            <div class="stat-item clickable" onclick="filterByType('commented')" title="Nur kommentierte Bilder">
                                <span class="stat-label">Kommentiert:</span>
                                <span class="stat-value" id="stat-commented">0</span>
                            </div>
                        </div>
                        
                        <div class="sidebar-section">
                            <h4>üè∑Ô∏è Markierungen</h4>
                            <div class="flag-summary" id="flag-summary">
                                <div class="flag-summary-item clickable" onclick="filterByFlag('reject')" title="Nur abgelehnte Bilder">
                                    <span class="flag-badge red">‚úó</span>
                                    <span class="flag-count" id="flag-reject">0</span>
                                </div>
                                <div class="flag-summary-item clickable" onclick="filterByFlag('review')" title="Nur zu pr√ºfende Bilder">
                                    <span class="flag-badge yellow">‚ö†</span>
                                    <span class="flag-count" id="flag-review">0</span>
                                </div>
                                <div class="flag-summary-item clickable" onclick="filterByFlag('approve')" title="Nur genehmigte Bilder">
                                    <span class="flag-badge green">‚úì</span>
                                    <span class="flag-count" id="flag-approve">0</span>
                                </div>
                                <div class="flag-summary-item clickable" onclick="filterByFlag('final')" title="Nur finale Bilder">
                                    <span class="flag-badge black">‚òÖ</span>
                                    <span class="flag-count" id="flag-final">0</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="sidebar-section">
                            <h4>üìÅ Auswahlen</h4>
                            <div class="selections-list" id="selections-list">
                                <p style="color: #888; font-size: 0.75em; margin: 0;">Keine Auswahlen</p>
                            </div>
                        </div>
                        
                        <!-- Bulk-Aktionen -->
                        <div class="sidebar-section" id="bulk-actions-section" style="display: none;">
                            <h4>‚ö° Bulk-Aktionen</h4>
                            <div style="display: flex; flex-direction: column; gap: 6px;">
                                <button class="btn-secondary" onclick="bulkAddToFavorites()" style="width: 100%; padding: 6px 12px; font-size: 12px;">‚ù§Ô∏è Als Favoriten markieren</button>
                                <button class="btn-secondary" onclick="bulkSetFlag()" style="width: 100%; padding: 6px 12px; font-size: 12px;">üè∑Ô∏è Markierung setzen</button>
                                <button class="btn-secondary" onclick="bulkAddToSelection()" style="width: 100%; padding: 6px 12px; font-size: 12px;">üìÅ Zu Auswahl hinzuf√ºgen</button>
                                <button class="btn-primary" onclick="bulkDownload()" style="width: 100%; padding: 6px 12px; font-size: 12px;">üì• Als ZIP herunterladen</button>
                                <button class="btn-secondary" onclick="exportAsPDF()" style="width: 100%; padding: 6px 12px; font-size: 12px; margin-top: 6px;">üìÑ Als PDF exportieren</button>
                                <button class="btn-secondary" onclick="clearSelection()" style="width: 100%; padding: 6px 12px; font-size: 12px; background: #444; border-color: #555;">‚úó Auswahl aufheben</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="flex: 1; display: flex; flex-direction: column;">
                    <!-- Breadcrumb -->
                    <div class="breadcrumb" id="breadcrumb" style="display: none;"></div>
                    <div class="gallery" id="gallery" style="flex: 1;"></div>
                </div>
            </div>
        </div>
        
        <div id="loading" class="loading" style="display: none;">
            <p>Lade Bilder...</p>
        </div>
        
        <div id="error" class="error" style="display: none;">
            <p>Fehler beim Laden der Bilder</p>
        </div>
    </div>
    
    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
        <button class="lightbox-nav lightbox-prev" onclick="previousImage()">‚Äπ</button>
        <div class="lightbox-content">
            <img id="lightbox-image" src="" alt="">
            <div style="position: absolute; bottom: 10px; left: 10px; display: flex; gap: 10px; z-index: 10;">
                <button class="download-btn" onclick="downloadImage()">üì• Download</button>
                <button class="download-btn" onclick="toggleSidebar()" id="feedback-toggle-btn">üí¨ Feedback</button>
            </div>
        </div>
        <button class="lightbox-nav lightbox-next" onclick="nextImage()">‚Ä∫</button>
        
        <!-- Feedback-Sidebar -->
        <div class="lightbox-sidebar" id="feedback-sidebar">
            <button onclick="toggleSidebar()" style="position: absolute; top: 12px; left: 8px; background: rgba(102, 126, 234, 0.2); border: 1px solid #667eea; border-radius: 4px; color: #667eea; font-size: 12px; cursor: pointer; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">&times;</button>
            <h3 id="feedback-image-name">Bild Feedback</h3>
            
            <!-- Bewertung -->
            <div class="feedback-section">
                <h4>‚≠ê Bewertung</h4>
                <div class="rating-stars" id="rating-stars">
                    <span class="star" data-rating="1" onclick="setRating(1)">‚òÖ</span>
                    <span class="star" data-rating="2" onclick="setRating(2)">‚òÖ</span>
                    <span class="star" data-rating="3" onclick="setRating(3)">‚òÖ</span>
                    <span class="star" data-rating="4" onclick="setRating(4)">‚òÖ</span>
                    <span class="star" data-rating="5" onclick="setRating(5)">‚òÖ</span>
                </div>
                <p id="rating-text" style="color: #888; font-size: 0.75em; margin-top: 4px;">Keine Bewertung</p>
            </div>
            
            <!-- Markierungen (Flags) -->
            <div class="feedback-section">
                <h4>üè∑Ô∏è Markierung</h4>
                <div class="flag-buttons">
                    <button class="flag-btn red" data-flag="reject" title="Ablehnen" onclick="setFlag('reject')">‚úó Ablehnen</button>
                    <button class="flag-btn yellow" data-flag="review" title="Pr√ºfen" onclick="setFlag('review')">‚ö† Pr√ºfen</button>
                    <button class="flag-btn green" data-flag="approve" title="Genehmigen" onclick="setFlag('approve')">‚úì Genehmigen</button>
                    <button class="flag-btn black" data-flag="final" title="Final" onclick="setFlag('final')">‚òÖ Final</button>
                </div>
            </div>
            
            <!-- Favorit -->
            <div class="feedback-section">
                <h4>‚ù§Ô∏è Favorit</h4>
                <button class="gallery-item-btn gallery-item-like" id="favorite-btn" onclick="toggleFavorite()" style="width: 100%; justify-content: center;">
                    <span id="favorite-icon">ü§ç</span> <span id="favorite-text">Als Favorit markieren</span>
                </button>
            </div>
            
            <!-- Kommentare -->
            <div class="feedback-section">
                <h4>üí¨ Kommentare</h4>
                <textarea class="comment-input" id="comment-input" placeholder="Ihr Kommentar..."></textarea>
                <button class="btn-primary" onclick="addComment()" style="width: 100%;">Kommentar hinzuf√ºgen</button>
                <div class="comment-list" id="comment-list"></div>
            </div>
            
            <!-- Auswahl -->
            <div class="feedback-section">
                <h4>üìÅ Auswahl</h4>
                <input type="text" id="selection-name" placeholder="Auswahl-Name" style="width: 100%; padding: 6px 8px; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); margin-bottom: 6px; font-size: 12px;">
                <button class="btn-secondary" onclick="addToSelection()" style="width: 100%;">Zu Auswahl hinzuf√ºgen</button>
                <div id="current-selections"></div>
            </div>
            
            <!-- Bild-Info -->
            <div class="feedback-section">
                <h4>‚ÑπÔ∏è Bild-Informationen</h4>
                <div id="image-info" style="font-size: 0.8em; color: var(--text-secondary); line-height: 1.6;">
                    <div><strong>Name:</strong> <span id="info-name">-</span></div>
                    <div><strong>Gr√∂√üe:</strong> <span id="info-size">-</span></div>
                    <div><strong>Aufl√∂sung:</strong> <span id="info-resolution">-</span></div>
                    <div><strong>Upload:</strong> <span id="info-upload">-</span></div>
                    <div><strong>Quelle:</strong> <span id="info-source">-</span></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Konfiguration
        let galleryConfig = null;
        let currentGallery = null;
        let currentImages = [];
        let currentImageIndex = 0;
        let searchQuery = '';
        
        // Feedback-Daten (wird in localStorage gespeichert)
        let feedbackData = {
            ratings: {},      // { imageId: rating (1-5) }
            flags: {},        // { imageId: 'reject'|'review'|'approve'|'final' }
            favorites: {},    // { imageId: true }
            comments: {},    // { imageId: [{ author, text, date }] }
            selections: {}    // { imageId: ['selection1', 'selection2'] }
        };
        
        // Theme Management
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                document.getElementById('theme-icon').textContent = '‚òÄÔ∏è';
            } else {
                document.body.classList.remove('light-mode');
                document.getElementById('theme-icon').textContent = 'üåô';
            }
        }
        
        function toggleTheme() {
            const isLight = document.body.classList.toggle('light-mode');
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
            document.getElementById('theme-icon').textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
        }
        
        // Breadcrumb Navigation
        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            if (!breadcrumb || !currentGallery) {
                if (breadcrumb) breadcrumb.style.display = 'none';
                return;
            }
            
            breadcrumb.style.display = 'flex';
            const parts = [];
            
            // Home
            parts.push('<span class="breadcrumb-item" onclick="showGallerySelector()">Home</span>');
            
            // Folder path
            if (currentGallery.folder) {
                const folderParts = currentGallery.folder.split('/');
                let currentPath = '';
                folderParts.forEach((part, index) => {
                    currentPath += (currentPath ? '/' : '') + part;
                    parts.push(`<span class="breadcrumb-separator">‚Ä∫</span>`);
                    parts.push(`<span class="breadcrumb-item" onclick="filterByFolder('${currentPath}')">${part}</span>`);
                });
            }
            
            // Current Gallery
            parts.push(`<span class="breadcrumb-separator">‚Ä∫</span>`);
            parts.push(`<span class="breadcrumb-item active">${currentGallery.name || 'Galerie'}</span>`);
            
            breadcrumb.innerHTML = parts.join('');
        }
        
        function filterByFolder(folderPath) {
            // Filtere Galerien nach Ordner
            if (!galleryConfig || !galleryConfig.galleries) return;
            
            const filtered = galleryConfig.galleries.filter(g => {
                if (!g.folder) return false;
                return g.folder.startsWith(folderPath);
            });
            
            if (filtered.length > 0) {
                showGallerySelector();
                // Highlight entsprechende Galerien
                setTimeout(() => {
                    document.querySelectorAll('.gallery-card').forEach(card => {
                        const galleryName = card.querySelector('h3')?.textContent;
                        const gallery = filtered.find(g => g.name === galleryName);
                        if (gallery) {
                            card.style.border = '2px solid #667eea';
                            card.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.3)';
                        }
                    });
                }, 100);
            }
        }
        
        // Search Functionality
        function initSearch() {
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    searchQuery = e.target.value.toLowerCase().trim();
                    applySearchAndFilter();
                });
            }
        }
        
        function applySearchAndFilter() {
            const items = document.querySelectorAll('.gallery-item');
            let visibleCount = 0;
            
            items.forEach(item => {
                const imageId = item.dataset.imageId;
                if (!imageId) {
                    item.style.display = 'none';
                    return;
                }
                
                // Finde Bild
                const imageIndex = parseInt(imageId.replace('img_', '')) || currentImages.findIndex(img => (img.id || `img_${currentImages.indexOf(img)}`) === imageId);
                const image = currentImages[imageIndex];
                
                let shouldShow = true;
                
                // Search Filter
                if (searchQuery) {
                    const searchableText = [
                        image?.name || '',
                        image?.id || '',
                        (feedbackData.comments[imageId] || []).map(c => c.text).join(' '),
                        (feedbackData.selections[imageId] || []).join(' ')
                    ].join(' ').toLowerCase();
                    
                    shouldShow = searchableText.includes(searchQuery);
                }
                
                // Existing Filter
                if (shouldShow) {
                    if (currentFilter.type === 'selected') {
                        shouldShow = item.classList.contains('selected');
                    } else if (currentFilter.type === 'favorites') {
                        shouldShow = feedbackData.favorites[imageId] || false;
                    } else if (currentFilter.type === 'commented') {
                        const comments = feedbackData.comments[imageId] || [];
                        shouldShow = comments.length > 0;
                    } else if (currentFilter.type === 'selection' && currentFilter.selectionName) {
                        const selections = feedbackData.selections[imageId] || [];
                        shouldShow = selections.includes(currentFilter.selectionName);
                    }
                    
                    if (shouldShow && currentFilter.flag) {
                        const flag = feedbackData.flags[imageId];
                        shouldShow = flag === currentFilter.flag;
                    }
                }
                
                if (shouldShow) {
                    item.style.display = '';
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Zeige Meldung wenn keine Bilder sichtbar
            const gallery = document.getElementById('gallery');
            let noResultsMsg = gallery.querySelector('.no-results-message');
            if (visibleCount === 0) {
                if (!noResultsMsg) {
                    noResultsMsg = document.createElement('p');
                    noResultsMsg.className = 'no-results-message';
                    noResultsMsg.style.cssText = 'text-align: center; color: var(--text-secondary); grid-column: 1 / -1; padding: 40px; font-size: 1.1em;';
                    noResultsMsg.textContent = searchQuery ? `Keine Ergebnisse f√ºr "${searchQuery}"` : 'Keine Bilder entsprechen dem Filter';
                    gallery.appendChild(noResultsMsg);
                } else {
                    noResultsMsg.textContent = searchQuery ? `Keine Ergebnisse f√ºr "${searchQuery}"` : 'Keine Bilder entsprechen dem Filter';
                }
            } else if (noResultsMsg) {
                noResultsMsg.remove();
            }
        }
        
        // Lade Feedback-Daten
        function loadFeedbackData() {
            const saved = localStorage.getItem('gallery_feedback');
            if (saved) {
                try {
                    feedbackData = JSON.parse(saved);
                } catch (e) {
                    console.error('Fehler beim Laden der Feedback-Daten:', e);
                }
            }
        }
        
        // Speichere Feedback-Daten
        function saveFeedbackData() {
            localStorage.setItem('gallery_feedback', JSON.stringify(feedbackData));
        }
        
        // Initialisiere Feedback-System
        loadFeedbackData();
        
        // Lade Konfiguration von gallery.json
        async function loadConfig() {
            try {
                // Cache-Busting: F√ºge Timestamp hinzu um sicherzustellen, dass die neueste Version geladen wird
                const cacheBuster = '?t=' + Date.now();
                const response = await fetch('./gallery.json' + cacheBuster);
                if (response.ok) {
                    galleryConfig = await response.json();
                    console.log('gallery.json geladen', {
                        version: galleryConfig.version,
                        galleries: galleryConfig.galleries?.length || 0,
                        generated: galleryConfig.generated
                    });
                    return true;
                } else {
                    console.error('gallery.json konnte nicht geladen werden:', response.status, response.statusText);
                }
                return false;
            } catch (error) {
                console.error('Fehler beim Laden der Konfiguration:', error);
                return false;
            }
        }
        
        // Zeige Galerie-Auswahl
        function showGallerySelector() {
            document.getElementById('gallery-selector').style.display = 'block';
            document.getElementById('password-form').style.display = 'none';
            document.getElementById('gallery-container').style.display = 'none';
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            
            // Verstecke Breadcrumb
            const breadcrumb = document.getElementById('breadcrumb');
            if (breadcrumb) breadcrumb.style.display = 'none';
            
            // Reset Search
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.value = '';
                searchQuery = '';
            }
            
            const galleryList = document.getElementById('gallery-list');
            galleryList.innerHTML = '';
            
            if (!galleryConfig || !galleryConfig.galleries || galleryConfig.galleries.length === 0) {
                galleryList.innerHTML = '<p style="text-align: center; color: #888; grid-column: 1 / -1;">Keine Galerien gefunden</p>';
                return;
            }
            
            // Gruppiere Galerien nach Ordnern
            const galleriesByFolder = {};
            const rootGalleries = [];
            
            galleryConfig.galleries.forEach((gallery) => {
                if (gallery.folder) {
                    if (!galleriesByFolder[gallery.folder]) {
                        galleriesByFolder[gallery.folder] = [];
                    }
                    galleriesByFolder[gallery.folder].push(gallery);
                } else {
                    rootGalleries.push(gallery);
                }
            });
            
            // Zeige Root-Galerien (ohne Ordner)
            rootGalleries.forEach((gallery) => {
                const card = createGalleryCard(gallery);
                galleryList.appendChild(card);
            });
            
            // Zeige Galerien nach Ordnern gruppiert
            Object.keys(galleriesByFolder).sort().forEach((folder) => {
                // Ordner-Header
                const folderHeader = document.createElement('div');
                folderHeader.className = 'gallery-folder-header';
                const isLightMode = document.body.classList.contains('light-mode');
                const headerColor = isLightMode ? '#1a1a1a' : '#667eea';
                const borderColor = isLightMode ? '#ddd' : '#333';
                folderHeader.style.cssText = `grid-column: 1 / -1; color: ${headerColor}; margin: 20px 0 10px 0; font-size: 1.2em; font-weight: 600; padding: 10px 0; border-bottom: 1px solid ${borderColor};`;
                folderHeader.innerHTML = `üìÅ ${folder}`;
                galleryList.appendChild(folderHeader);
                
                // Galerien in diesem Ordner
                galleriesByFolder[folder].forEach((gallery) => {
                    const card = createGalleryCard(gallery);
                    galleryList.appendChild(card);
                });
            });
        }
        
        // Erstelle Galerie-Karte
        function createGalleryCard(gallery) {
            const card = document.createElement('div');
            card.className = 'gallery-card' + (gallery.password ? ' locked' : '');
            
            // Vorschaubild f√ºr nicht gesch√ºtzte Galerien
            let previewImage = '';
            if (!gallery.password && gallery.images && gallery.images.length > 0) {
                const firstImage = gallery.images[0];
                let thumbnailUrl = firstImage.thumbnailUrl || firstImage.url;
                
                // Verbessere Thumbnail-Qualit√§t f√ºr Vorschaubild (500x500px f√ºr Galerie-Karten)
                if (thumbnailUrl.includes('res.cloudinary.com') && thumbnailUrl.includes('/upload/')) {
                    // Ersetze alte kleine Thumbnails durch gr√∂√üere
                    if (thumbnailUrl.includes('/c_limit,h_60,w_90/') || thumbnailUrl.includes('/c_fill,h_60,w_90/')) {
                        thumbnailUrl = thumbnailUrl.replace(
                            /\/upload\/[^\/]+\//,
                            '/upload/c_fill,h_500,w_500,q_auto:good,f_auto/'
                        );
                    } else if (!thumbnailUrl.includes('/c_') && !thumbnailUrl.includes('/w_') && !thumbnailUrl.includes('/h_')) {
                        // Keine Transformation - f√ºge hinzu
                        thumbnailUrl = thumbnailUrl.replace(
                            /\/upload\//,
                            '/upload/c_fill,h_500,w_500,q_auto:good,f_auto/'
                        );
                    }
                }
                
                previewImage = `<img src="${thumbnailUrl}" alt="${gallery.name}" class="gallery-card-preview" loading="lazy">`;
            }
            
            card.innerHTML = `
                ${gallery.password ? '<span class="lock-icon">üîí</span>' : previewImage}
                <h3>${gallery.name || 'Unbenannte Galerie'}</h3>
                <p>${gallery.description || ''}</p>
                <p class="image-count">${gallery.images?.length || 0} Bilder</p>
            `;
            card.onclick = () => selectGallery(gallery);
            return card;
        }
        
        // W√§hle eine Galerie aus
        function selectGallery(gallery) {
            currentGallery = gallery;
            
            // Pr√ºfe ob Passwort erforderlich ist
            if (gallery.password) {
                document.getElementById('gallery-selector').style.display = 'none';
                document.getElementById('password-form').style.display = 'block';
                document.getElementById('gallery-name-display').textContent = gallery.name || 'Galerie';
                document.getElementById('password-input').value = '';
                document.getElementById('password-input').focus();
            } else {
                // Kein Passwort - zeige Galerie direkt
                showGallery(gallery);
            }
        }
        
        // Passwort-Pr√ºfung
        function checkPassword() {
            const input = document.getElementById('password-input').value;
            const errorEl = document.getElementById('password-error');
            
            if (currentGallery && currentGallery.password) {
                if (input === currentGallery.password) {
                    showGallery(currentGallery);
                } else {
                    errorEl.style.display = 'block';
                    setTimeout(() => {
                        errorEl.style.display = 'none';
                    }, 3000);
                }
            }
        }
        
        // Enter-Taste f√ºr Passwort
        document.getElementById('password-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });
        
        // Zeige Galerie
        function showGallery(gallery) {
            document.getElementById('gallery-selector').style.display = 'none';
            document.getElementById('password-form').style.display = 'none';
            document.getElementById('gallery-container').style.display = 'block';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            
            // Zeige Zur√ºck-Button nur wenn mehrere Galerien vorhanden
            if (galleryConfig && galleryConfig.galleries && galleryConfig.galleries.length > 1) {
                document.getElementById('back-button').style.display = 'block';
            } else {
                document.getElementById('back-button').style.display = 'none';
            }
            
            currentImages = gallery.images || [];
            console.log('Lade', currentImages.length, 'Bilder - "' + (gallery.name || 'Unbekannt') + '"');
            updateBreadcrumb();
            displayGallery(currentImages);
            document.getElementById('loading').style.display = 'none';
        }
        
        // Skeleton Screen f√ºr Ladeanimation
        function createSkeletonItems(count) {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const skeleton = document.createElement('div');
                skeleton.className = 'gallery-item skeleton';
                skeleton.innerHTML = '<div class="skeleton-shimmer"></div>';
                gallery.appendChild(skeleton);
            }
        }
        
        // Zeige Galerie-Bilder
        function displayGallery(images) {
            const gallery = document.getElementById('gallery');
            
            if (images.length === 0) {
                gallery.innerHTML = '<p style="text-align: center; color: var(--text-secondary); grid-column: 1 / -1;">Keine Bilder gefunden</p>';
                return;
            }
            
            // Zeige Skeleton Screens w√§hrend des Ladens
            createSkeletonItems(Math.min(images.length, 12));
            
            let loadedCount = 0;
            const totalImages = images.length;
            const items = [];
            
            images.forEach((image, index) => {
                const item = document.createElement('div');
                item.className = 'gallery-item';
                item.dataset.imageId = image.id || `img_${index}`;
                
                // Erstelle hochwertiges Thumbnail-URL mit Progressive Loading
                let imgSrc = image.thumbnailUrl || image.url || `./images/${image.name}`;
                const fullSrc = image.url || `./images/${image.name}`;
                
                // Progressive Loading: Zuerst kleines Thumbnail, dann gr√∂√üeres
                let lowQualitySrc = imgSrc;
                let highQualitySrc = imgSrc;
                
                // Wenn Cloudinary-URL vorhanden, aber altes Format (h_60,w_90), ersetze durch gr√∂√üeres Thumbnail
                if (imgSrc.includes('res.cloudinary.com') && imgSrc.includes('/upload/')) {
                    // Pr√ºfe ob bereits Transformation vorhanden
                    if (imgSrc.includes('/c_limit,h_60,w_90/') || imgSrc.includes('/c_fill,h_60,w_90/')) {
                        // Low Quality f√ºr schnelles Laden
                        lowQualitySrc = imgSrc.replace(
                            /\/upload\/[^\/]+\//,
                            '/upload/c_fill,h_200,w_200,q_auto:low,f_auto,blur:200/'
                        );
                        // High Quality Thumbnail (400x400px)
                        highQualitySrc = imgSrc.replace(
                            /\/upload\/[^\/]+\//,
                            '/upload/c_fill,h_400,w_400,q_auto:good,f_auto/'
                        );
                    } else if (!imgSrc.includes('/c_') && !imgSrc.includes('/w_') && !imgSrc.includes('/h_')) {
                        // Keine Transformation vorhanden - f√ºge hinzu
                        lowQualitySrc = imgSrc.replace(
                            /\/upload\//,
                            '/upload/c_fill,h_200,w_200,q_auto:low,f_auto,blur:200/'
                        );
                        highQualitySrc = imgSrc.replace(
                            /\/upload\//,
                            '/upload/c_fill,h_400,w_400,q_auto:good,f_auto/'
                        );
                    } else {
                        // Bereits Transformation vorhanden - f√ºge Low Quality Version hinzu
                        lowQualitySrc = imgSrc.replace(
                            /\/upload\/[^\/]+\//,
                            '/upload/c_fill,h_200,w_200,q_auto:low,f_auto,blur:200/'
                        );
                        highQualitySrc = imgSrc;
                    }
                }
                
                const img = document.createElement('img');
                img.alt = image.name || 'Bild';
                img.loading = 'lazy';
                
                // Progressive Loading: Lade zuerst Low Quality, dann High Quality
                img.src = lowQualitySrc;
                img.style.filter = 'blur(5px)';
                img.style.transition = 'filter 0.3s';
                
                // Lade High Quality im Hintergrund
                const highQualityImg = new Image();
                highQualityImg.onload = function() {
                    img.src = highQualitySrc;
                    img.style.filter = 'blur(0)';
                };
                highQualityImg.src = highQualitySrc;
                
                // Fallback: Wenn High Quality nicht l√§dt, behalte Low Quality
                highQualityImg.onerror = function() {
                    img.style.filter = 'blur(0)';
                };
                
                img.onerror = function() {
                    // Fallback 1: Versuche ohne ./ prefix
                    if (this.src.includes('./')) {
                        this.src = this.src.replace('./', '/');
                        return;
                    }
                    // Fallback 2: Versuche direkte URL wenn thumbnailUrl fehlgeschlagen
                    if (image.url && this.src !== image.url) {
                        // Versuche hochwertiges Thumbnail aus original URL zu erstellen
                        if (image.url.includes('res.cloudinary.com')) {
                            this.src = image.url.replace(
                                /\/upload\//,
                                '/upload/c_fill,h_400,w_400,q_auto:good,f_auto/'
                            );
                        } else {
                            this.src = image.url;
                        }
                        return;
                    }
                    // Fallback 3: Zeige Fehler-Placeholder
                    this.onerror = null; // Verhindere Endlosschleife
                    this.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="200" height="200"%3E%3Crect fill="%23222" width="200" height="200"/%3E%3Ctext fill="%23888" font-family="sans-serif" font-size="14" x="50%25" y="50%25" text-anchor="middle" dy=".3em"%3EBild nicht gefunden%3C/text%3E%3C/svg%3E';
                };
                
                // Overlay mit Features
                const overlay = document.createElement('div');
                overlay.className = 'gallery-item-overlay';
                
                // Checkbox f√ºr Auswahl
                const checkbox = document.createElement('div');
                checkbox.className = 'gallery-item-checkbox';
                checkbox.onclick = (e) => {
                    e.stopPropagation();
                    toggleImageSelection(image.id || `img_${index}`);
                };
                overlay.appendChild(checkbox);
                
                // Actions (Like, Kommentare)
                const actions = document.createElement('div');
                actions.className = 'gallery-item-actions';
                
                const imageId = image.id || `img_${index}`;
                const isFavorite = feedbackData.favorites[imageId] || false;
                const commentCount = (feedbackData.comments[imageId] || []).length;
                
                const likeBtn = document.createElement('button');
                likeBtn.className = 'gallery-item-btn gallery-item-like' + (isFavorite ? ' active' : '');
                likeBtn.innerHTML = `<span>${isFavorite ? '‚ù§Ô∏è' : 'ü§ç'}</span> <span>${isFavorite ? '1' : '0'}</span>`;
                likeBtn.onclick = (e) => {
                    e.stopPropagation();
                    toggleFavoriteFromGallery(imageId);
                };
                actions.appendChild(likeBtn);
                
                const commentBtn = document.createElement('button');
                commentBtn.className = 'gallery-item-btn';
                commentBtn.innerHTML = `<span>üí¨</span> <span>${commentCount}</span>`;
                commentBtn.onclick = (e) => {
                    e.stopPropagation();
                    openLightbox(index, fullSrc);
                    setTimeout(() => toggleSidebar(), 300);
                };
                actions.appendChild(commentBtn);
                
                overlay.appendChild(actions);
                
                // Badges f√ºr Markierungen
                updateImageBadges(item, image.id || `img_${index}`);
                
                item.appendChild(img);
                item.appendChild(overlay);
                item.onclick = () => openLightbox(index, fullSrc);
                
                items.push(item);
            });
            
            // Ersetze Skeletons durch echte Items
            const skeletons = gallery.querySelectorAll('.skeleton');
            items.forEach((item, idx) => {
                if (skeletons[idx]) {
                    skeletons[idx].replaceWith(item);
                } else {
                    gallery.appendChild(item);
                }
            });
            
            // Entferne verbleibende Skeletons
            setTimeout(() => {
                document.querySelectorAll('.skeleton').forEach(s => s.remove());
            }, 500);
            
            // Update alle Badges nach dem Rendern
            updateAllImageBadges();
            
            // Update Sidebar-Statistiken
            updateSidebarStats();
            
            // Filter anwenden
            applyFilter();
            updateFilterUI();
        }
        
        // Aktiver Filter
        let currentFilter = {
            type: 'all',  // 'all', 'selected', 'favorites', 'commented', 'selection'
            flag: null,   // 'reject', 'review', 'approve', 'final', null
            selectionName: null  // Name der Auswahl, wenn type === 'selection'
        };
        
        // Toggle Gallery Sidebar
        function toggleGallerySidebar() {
            const sidebar = document.getElementById('gallery-sidebar');
            const toggleIcon = document.getElementById('sidebar-toggle-icon');
            sidebar.classList.toggle('collapsed');
            toggleIcon.textContent = sidebar.classList.contains('collapsed') ? '‚óÄ' : '‚ñ∂';
        }
        
        // Filter nach Typ
        function filterByType(type) {
            currentFilter.type = type;
            currentFilter.flag = null;
            currentFilter.selectionName = null;
            applyFilter();
            updateFilterUI();
        }
        
        // Filter nach Flag
        function filterByFlag(flag) {
            if (currentFilter.flag === flag) {
                // Toggle: Wenn bereits aktiv, zur√ºcksetzen
                currentFilter.flag = null;
                currentFilter.type = 'all';
            } else {
                currentFilter.flag = flag;
                currentFilter.type = 'all';
            }
            currentFilter.selectionName = null;
            applyFilter();
            updateFilterUI();
        }
        
        // Filter anwenden
        function applyFilter() {
            applySearchAndFilter();
        }
        
        // Update Filter UI (aktive Zust√§nde)
        function updateFilterUI() {
            // Entferne alle aktiven Zust√§nde
            document.querySelectorAll('.stat-item, .flag-summary-item, .selection-item').forEach(el => {
                el.classList.remove('active');
            });
            
            // Setze aktiven Zustand f√ºr Typ-Filter
            if (currentFilter.type === 'all') {
                document.querySelectorAll('.stat-item')[0].classList.add('active');
            } else if (currentFilter.type === 'selection') {
                // Aktiviere entsprechende Auswahl
                const selectionItems = document.querySelectorAll('.selection-item');
                selectionItems.forEach(item => {
                    if (item.textContent.includes(currentFilter.selectionName)) {
                        item.classList.add('active');
                    }
                });
            } else {
                const statItems = document.querySelectorAll('.stat-item');
                const typeMap = {
                    'selected': 1,
                    'favorites': 2,
                    'commented': 3
                };
                if (typeMap[currentFilter.type] !== undefined) {
                    statItems[typeMap[currentFilter.type]].classList.add('active');
                }
            }
            
            // Setze aktiven Zustand f√ºr Flag-Filter
            if (currentFilter.flag) {
                const flagItems = document.querySelectorAll('.flag-summary-item');
                const flagMap = {
                    'reject': 0,
                    'review': 1,
                    'approve': 2,
                    'final': 3
                };
                if (flagMap[currentFilter.flag] !== undefined) {
                    flagItems[flagMap[currentFilter.flag]].classList.add('active');
                }
            }
        }
        
        // Update Sidebar Statistiken
        function updateSidebarStats() {
            const total = currentImages.length;
            const selected = document.querySelectorAll('.gallery-item.selected').length;
            const favorites = Object.keys(feedbackData.favorites).filter(id => {
                return currentImages.some(img => (img.id || `img_${currentImages.indexOf(img)}`) === id);
            }).length;
            const commented = Object.keys(feedbackData.comments).filter(id => {
                const comments = feedbackData.comments[id] || [];
                return comments.length > 0 && currentImages.some(img => (img.id || `img_${currentImages.indexOf(img)}`) === id);
            }).length;
            
            // Flag-Z√§hler
            const flagCounts = {
                reject: 0,
                review: 0,
                approve: 0,
                final: 0
            };
            
            currentImages.forEach((img, index) => {
                const imageId = img.id || `img_${index}`;
                const flag = feedbackData.flags[imageId];
                if (flag && flagCounts.hasOwnProperty(flag)) {
                    flagCounts[flag]++;
                }
            });
            
            // Update DOM
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-selected').textContent = selected;
            document.getElementById('stat-favorites').textContent = favorites;
            document.getElementById('stat-commented').textContent = commented;
            
            document.getElementById('flag-reject').textContent = flagCounts.reject;
            document.getElementById('flag-review').textContent = flagCounts.review;
            document.getElementById('flag-approve').textContent = flagCounts.approve;
            document.getElementById('flag-final').textContent = flagCounts.final;
            
            // Update Auswahlen-Liste
            const selectionsSet = new Set();
            currentImages.forEach((img, index) => {
                const imageId = img.id || `img_${index}`;
                const selections = feedbackData.selections[imageId] || [];
                selections.forEach(s => selectionsSet.add(s));
            });
            
            const selectionsList = document.getElementById('selections-list');
            if (selectionsSet.size === 0) {
                selectionsList.innerHTML = '<p style="color: #888; font-size: 0.75em; margin: 0;">Keine Auswahlen</p>';
            } else {
                selectionsList.innerHTML = Array.from(selectionsSet).map(s => {
                    const count = currentImages.filter((img, index) => {
                        const imageId = img.id || `img_${index}`;
                        return (feedbackData.selections[imageId] || []).includes(s);
                    }).length;
                    return `<div class="selection-item clickable" onclick="filterBySelection('${s.replace(/'/g, "\\'")}')" title="Nur Bilder in dieser Auswahl">üìÅ ${s} <span style="float: right; font-weight: 600;">${count}</span></div>`;
                }).join('');
            }
        }
        
        // Filter nach Auswahl
        function filterBySelection(selectionName) {
            if (currentFilter.type === 'selection' && currentFilter.selectionName === selectionName) {
                // Toggle: Wenn bereits aktiv, zur√ºcksetzen
                currentFilter.type = 'all';
                currentFilter.selectionName = null;
            } else {
                currentFilter.type = 'selection';
                currentFilter.selectionName = selectionName;
            }
            currentFilter.flag = null;
            applyFilter();
            updateFilterUI();
        }
        
        // Update Badges f√ºr ein Bild
        function updateImageBadges(item, imageId) {
            if (!item || !imageId) return;
            
            // Entferne alte Badges
            const oldBadges = item.querySelectorAll('.gallery-item-badge, .selection-badge');
            oldBadges.forEach(b => b.remove());
            
            const flag = feedbackData.flags[imageId];
            if (flag) {
                const badge = document.createElement('div');
                badge.className = 'gallery-item-badge';
                const flagLabels = {
                    'reject': '‚úó Abgelehnt',
                    'review': '‚ö† Pr√ºfen',
                    'approve': '‚úì Genehmigt',
                    'final': '‚òÖ Final'
                };
                badge.textContent = flagLabels[flag] || flag;
                badge.style.background = flag === 'reject' ? 'rgba(255,107,107,0.9)' :
                                         flag === 'review' ? 'rgba(255,217,61,0.9)' :
                                         flag === 'approve' ? 'rgba(107,207,127,0.9)' :
                                         'rgba(51,51,51,0.9)';
                item.appendChild(badge);
            }
            
            const selections = feedbackData.selections[imageId] || [];
            if (selections.length > 0) {
                const selectionBadge = document.createElement('div');
                selectionBadge.className = 'selection-badge';
                selectionBadge.textContent = `üìÅ ${selections[0]}${selections.length > 1 ? ` +${selections.length - 1}` : ''}`;
                item.appendChild(selectionBadge);
            }
        }
        
        // Update alle Badges
        function updateAllImageBadges() {
            const items = document.querySelectorAll('.gallery-item');
            items.forEach(item => {
                const imageId = item.dataset.imageId;
                if (imageId) {
                    updateImageBadges(item, imageId);
                }
            });
        }
        
        // Lightbox
        function openLightbox(index, fullImageUrl = null) {
            currentImageIndex = index;
            const lightbox = document.getElementById('lightbox');
            const img = document.getElementById('lightbox-image');
            
            const image = currentImages[index];
            const imageUrl = fullImageUrl || image.url || `./images/${image.name}`;
            
            img.src = imageUrl;
            img.alt = image.name || 'Bild';
            lightbox.classList.add('active');
            
            // Update Feedback-Sidebar f√ºr aktuelles Bild
            updateFeedbackSidebar();
        }
        
        // Update Badges f√ºr ein Bild
        function updateImageBadges(item, imageId) {
            if (!item || !imageId) return;
            
            // Entferne alte Badges
            const oldBadges = item.querySelectorAll('.gallery-item-badge, .selection-badge');
            oldBadges.forEach(b => b.remove());
            
            const flag = feedbackData.flags[imageId];
            if (flag) {
                const badge = document.createElement('div');
                badge.className = 'gallery-item-badge';
                const flagLabels = {
                    'reject': '‚úó Abgelehnt',
                    'review': '‚ö† Pr√ºfen',
                    'approve': '‚úì Genehmigt',
                    'final': '‚òÖ Final'
                };
                badge.textContent = flagLabels[flag] || flag;
                badge.style.background = flag === 'reject' ? 'rgba(255,107,107,0.9)' :
                                         flag === 'review' ? 'rgba(255,217,61,0.9)' :
                                         flag === 'approve' ? 'rgba(107,207,127,0.9)' :
                                         'rgba(51,51,51,0.9)';
                item.appendChild(badge);
            }
            
            const selections = feedbackData.selections[imageId] || [];
            if (selections.length > 0) {
                const selectionBadge = document.createElement('div');
                selectionBadge.className = 'selection-badge';
                selectionBadge.textContent = `üìÅ ${selections[0]}${selections.length > 1 ? ` +${selections.length - 1}` : ''}`;
                item.appendChild(selectionBadge);
            }
        }
        
        // Update alle Badges
        function updateAllImageBadges() {
            const items = document.querySelectorAll('.gallery-item');
            items.forEach(item => {
                const imageId = item.dataset.imageId;
                if (imageId) {
                    updateImageBadges(item, imageId);
                }
            });
        }
        
        // Toggle Bild-Auswahl
        function toggleImageSelection(imageId) {
            const item = document.querySelector(`[data-image-id="${imageId}"]`);
            if (!item) return;
            
            const checkbox = item.querySelector('.gallery-item-checkbox');
            if (checkbox.classList.contains('checked')) {
                checkbox.classList.remove('checked');
                checkbox.textContent = '';
                item.classList.remove('selected');
            } else {
                checkbox.classList.add('checked');
                checkbox.textContent = '‚úì';
                item.classList.add('selected');
            }
            
            // Update Sidebar-Statistiken
            updateSidebarStats();
            
            // Zeige/Verstecke Bulk-Aktionen
            updateBulkActionsVisibility();
            
            // Filter neu anwenden (falls "Ausgew√§hlt" Filter aktiv)
            if (currentFilter.type === 'selected') {
                applyFilter();
            }
        }
        
        // Update Bulk-Aktionen Sichtbarkeit
        function updateBulkActionsVisibility() {
            const selectedCount = document.querySelectorAll('.gallery-item.selected').length;
            const bulkSection = document.getElementById('bulk-actions-section');
            if (bulkSection) {
                bulkSection.style.display = selectedCount > 0 ? 'block' : 'none';
            }
        }
        
        // Bulk-Aktionen
        function bulkAddToFavorites() {
            const selected = document.querySelectorAll('.gallery-item.selected');
            selected.forEach(item => {
                const imageId = item.dataset.imageId;
                if (imageId) {
                    feedbackData.favorites[imageId] = true;
                    updateFavoriteUI(imageId);
                }
            });
            saveFeedbackData();
            updateAllImageBadges();
            updateSidebarStats();
        }
        
        function bulkSetFlag() {
            const flag = prompt('Markierung w√§hlen:\n1 = Abgelehnt\n2 = Pr√ºfen\n3 = Genehmigt\n4 = Final', '3');
            if (!flag) return;
            
            const flagMap = { '1': 'reject', '2': 'review', '3': 'approve', '4': 'final' };
            const selectedFlag = flagMap[flag];
            if (!selectedFlag) return;
            
            const selected = document.querySelectorAll('.gallery-item.selected');
            selected.forEach(item => {
                const imageId = item.dataset.imageId;
                if (imageId) {
                    feedbackData.flags[imageId] = selectedFlag;
                }
            });
            saveFeedbackData();
            updateAllImageBadges();
            updateSidebarStats();
        }
        
        function bulkAddToSelection() {
            const selectionName = prompt('Auswahl-Name eingeben:');
            if (!selectionName || !selectionName.trim()) return;
            
            const selected = document.querySelectorAll('.gallery-item.selected');
            selected.forEach(item => {
                const imageId = item.dataset.imageId;
                if (imageId) {
                    if (!feedbackData.selections[imageId]) {
                        feedbackData.selections[imageId] = [];
                    }
                    if (!feedbackData.selections[imageId].includes(selectionName.trim())) {
                        feedbackData.selections[imageId].push(selectionName.trim());
                    }
                }
            });
            saveFeedbackData();
            updateAllImageBadges();
            updateSidebarStats();
        }
        
        async function bulkDownload() {
            const selected = document.querySelectorAll('.gallery-item.selected');
            if (selected.length === 0) {
                alert('Keine Bilder ausgew√§hlt');
                return;
            }
            
            if (!confirm(`${selected.length} Bild(er) herunterladen?`)) return;
            
            // Zeige Progress
            const progressDiv = document.createElement('div');
            progressDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-secondary); padding: 20px; border-radius: 8px; z-index: 10000; border: 2px solid var(--accent);';
            progressDiv.innerHTML = `<p>Lade ${selected.length} Bild(er) herunter...</p><div style="width: 200px; height: 4px; background: var(--bg-tertiary); border-radius: 2px; margin-top: 10px;"><div id="download-progress" style="width: 0%; height: 100%; background: var(--accent); border-radius: 2px; transition: width 0.3s;"></div></div>`;
            document.body.appendChild(progressDiv);
            
            let downloaded = 0;
            for (const item of selected) {
                const imageId = item.dataset.imageId;
                if (!imageId) continue;
                
                const imageIndex = parseInt(imageId.replace('img_', '')) || currentImages.findIndex(img => (img.id || `img_${currentImages.indexOf(img)}`) === imageId);
                const image = currentImages[imageIndex];
                if (!image) continue;
                
                try {
                    await downloadImageById(imageId);
                    downloaded++;
                    const progress = (downloaded / selected.length) * 100;
                    document.getElementById('download-progress').style.width = progress + '%';
                } catch (error) {
                    console.error('Download-Fehler:', error);
                }
                
                // Kleine Pause zwischen Downloads
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            progressDiv.remove();
            alert(`${downloaded} von ${selected.length} Bild(er) erfolgreich heruntergeladen`);
        }
        
        function downloadImageById(imageId) {
            const imageIndex = parseInt(imageId.replace('img_', '')) || currentImages.findIndex(img => (img.id || `img_${currentImages.indexOf(img)}`) === imageId);
            const image = currentImages[imageIndex];
            if (!image) return Promise.reject('Bild nicht gefunden');
            
            return new Promise((resolve, reject) => {
                const imageUrl = image.url || `./images/${image.name}`;
                const fileName = image.name || 'image.jpg';
                
                // F√ºr Cloudinary: Entferne Transformationen
                let downloadUrl = imageUrl;
                if (imageUrl.includes('res.cloudinary.com') && imageUrl.includes('/upload/')) {
                    downloadUrl = imageUrl.replace(/\/upload\/[^\/]+\//, '/upload/');
                }
                
                fetch(downloadUrl)
                    .then(response => response.blob())
                    .then(blob => {
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = fileName;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                        resolve();
                    })
                    .catch(reject);
            });
        }
        
        function clearSelection() {
            document.querySelectorAll('.gallery-item.selected').forEach(item => {
                item.classList.remove('selected');
                const checkbox = item.querySelector('.gallery-item-checkbox');
                if (checkbox) {
                    checkbox.classList.remove('checked');
                    checkbox.textContent = '';
                }
            });
            updateBulkActionsVisibility();
            updateSidebarStats();
        }
        
        // Export als ZIP (mit JSZip)
        async function bulkDownload() {
            const selected = document.querySelectorAll('.gallery-item.selected');
            if (selected.length === 0) {
                alert('Keine Bilder ausgew√§hlt');
                return;
            }
            
            if (!confirm(`${selected.length} Bild(er) als ZIP herunterladen?`)) return;
            
            // Lade JSZip dynamisch
            if (!window.JSZip) {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
                await new Promise((resolve, reject) => {
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            }
            
            // Zeige Progress
            const progressDiv = document.createElement('div');
            progressDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-secondary); padding: 20px; border-radius: 8px; z-index: 10000; border: 2px solid var(--accent); min-width: 250px;';
            progressDiv.innerHTML = `<p style="margin-bottom: 10px;">Erstelle ZIP...</p><div style="width: 200px; height: 4px; background: var(--bg-tertiary); border-radius: 2px;"><div id="download-progress" style="width: 0%; height: 100%; background: var(--accent); border-radius: 2px; transition: width 0.3s;"></div></div><p id="progress-text" style="margin-top: 10px; font-size: 0.85em; color: var(--text-secondary);">0 / ${selected.length}</p>`;
            document.body.appendChild(progressDiv);
            
            const zip = new JSZip();
            let processed = 0;
            
            try {
                for (const item of selected) {
                    const imageId = item.dataset.imageId;
                    if (!imageId) continue;
                    
                    const imageIndex = parseInt(imageId.replace('img_', '')) || currentImages.findIndex(img => (img.id || `img_${currentImages.indexOf(img)}`) === imageId);
                    const image = currentImages[imageIndex];
                    if (!image) continue;
                    
                    try {
                        const imageUrl = image.url || `./images/${image.name}`;
                        let downloadUrl = imageUrl;
                        
                        // F√ºr Cloudinary: Entferne Transformationen
                        if (imageUrl.includes('res.cloudinary.com') && imageUrl.includes('/upload/')) {
                            downloadUrl = imageUrl.replace(/\/upload\/[^\/]+\//, '/upload/');
                        }
                        
                        const response = await fetch(downloadUrl);
                        const blob = await response.blob();
                        const fileName = image.name || `image_${imageIndex}.jpg`;
                        zip.file(fileName, blob);
                        
                        processed++;
                        const progress = (processed / selected.length) * 100;
                        document.getElementById('download-progress').style.width = progress + '%';
                        document.getElementById('progress-text').textContent = `${processed} / ${selected.length}`;
                    } catch (error) {
                        console.error('Fehler beim Laden von Bild:', error);
                    }
                }
                
                // Erstelle ZIP
                const zipBlob = await zip.generateAsync({ type: 'blob' });
                const url = window.URL.createObjectURL(zipBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `galerie-export-${new Date().toISOString().split('T')[0]}.zip`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                progressDiv.remove();
                alert(`${processed} Bild(er) erfolgreich als ZIP heruntergeladen`);
            } catch (error) {
                progressDiv.remove();
                alert('Fehler beim Erstellen der ZIP-Datei: ' + error.message);
            }
        }
        
        // Export als PDF (einfache Version)
        async function exportAsPDF() {
            const selected = document.querySelectorAll('.gallery-item.selected');
            if (selected.length === 0) {
                alert('Keine Bilder ausgew√§hlt');
                return;
            }
            
            alert('PDF-Export wird vorbereitet...\n\nHinweis: F√ºr vollst√§ndigen PDF-Export wird eine externe Bibliothek ben√∂tigt. Aktuell k√∂nnen Sie die Bilder als ZIP herunterladen.');
            // TODO: PDF-Export mit jsPDF implementieren
        }
        
        // Toggle Favorit
        // Toggle Favorit (f√ºr Sidebar)
        function toggleFavorite() {
            const image = currentImages[currentImageIndex];
            if (!image) return;
            
            const imageId = image.id || `img_${currentImageIndex}`;
            if (feedbackData.favorites[imageId]) {
                delete feedbackData.favorites[imageId];
            } else {
                feedbackData.favorites[imageId] = true;
            }
            saveFeedbackData();
            updateFavoriteUI(imageId);
            updateAllImageBadges();
        }
        
        // Toggle Favorit (f√ºr Gallery Item)
        function toggleFavoriteFromGallery(imageId) {
            if (feedbackData.favorites[imageId]) {
                delete feedbackData.favorites[imageId];
            } else {
                feedbackData.favorites[imageId] = true;
            }
            saveFeedbackData();
            updateFavoriteUI(imageId);
            updateAllImageBadges();
            updateSidebarStats();
            
            // Filter neu anwenden (falls "Favoriten" Filter aktiv)
            if (currentFilter.type === 'favorites') {
                applyFilter();
            }
        }
        
        // Update Favorit-UI
        function updateFavoriteUI(imageId) {
            const isFavorite = feedbackData.favorites[imageId] || false;
            
            // Update in Gallery
            const item = document.querySelector(`[data-image-id="${imageId}"]`);
            if (item) {
                const likeBtn = item.querySelector('.gallery-item-like');
                if (likeBtn) {
                    likeBtn.innerHTML = `<span>${isFavorite ? '‚ù§Ô∏è' : 'ü§ç'}</span> <span>${isFavorite ? '1' : '0'}</span>`;
                    likeBtn.classList.toggle('active', isFavorite);
                }
            }
            
            // Update in Sidebar
            const favoriteBtn = document.getElementById('favorite-btn');
            const favoriteIcon = document.getElementById('favorite-icon');
            const favoriteText = document.getElementById('favorite-text');
            if (favoriteBtn && favoriteIcon && favoriteText) {
                favoriteIcon.textContent = isFavorite ? '‚ù§Ô∏è' : 'ü§ç';
                favoriteText.textContent = isFavorite ? 'Als Favorit entfernen' : 'Als Favorit markieren';
                favoriteBtn.classList.toggle('active', isFavorite);
            }
        }
        
        // Update Feedback-Sidebar
        function updateFeedbackSidebar() {
            const image = currentImages[currentImageIndex];
            if (!image) return;
            
            const imageId = image.id || `img_${currentImageIndex}`;
            
            // Bild-Name
            document.getElementById('feedback-image-name').textContent = image.name || 'Bild Feedback';
            
            // Bild-Info
            updateImageInfo(image);
            
            // Bewertung
            const rating = feedbackData.ratings[imageId] || 0;
            updateRatingStars(rating);
            
            // Markierung
            const flag = feedbackData.flags[imageId] || null;
            updateFlagButtons(flag);
            
            // Favorit
            updateFavoriteUI(imageId);
            
            // Kommentare
            displayComments(imageId);
            
            // Auswahlen
            displaySelections(imageId);
        }
        
        // Update Bild-Informationen
        function updateImageInfo(image) {
            if (!image) return;
            
            document.getElementById('info-name').textContent = image.name || '-';
            
            // Gr√∂√üe
            if (image.width && image.height) {
                const mp = ((image.width * image.height) / 1000000).toFixed(1);
                document.getElementById('info-size').textContent = `${mp} MP`;
            } else {
                document.getElementById('info-size').textContent = '-';
            }
            
            // Aufl√∂sung
            if (image.width && image.height) {
                document.getElementById('info-resolution').textContent = `${image.width} √ó ${image.height}`;
            } else {
                document.getElementById('info-resolution').textContent = '-';
            }
            
            // Upload-Datum
            if (image.uploadDate) {
                const date = new Date(image.uploadDate);
                document.getElementById('info-upload').textContent = date.toLocaleDateString('de-CH') + ' ' + date.toLocaleTimeString('de-CH', { hour: '2-digit', minute: '2-digit' });
            } else {
                document.getElementById('info-upload').textContent = '-';
            }
            
            // Quelle
            const sourceLabels = {
                'cloudinary': 'Cloudinary',
                'github': 'GitHub',
                'local': 'Lokal'
            };
            document.getElementById('info-source').textContent = sourceLabels[image.source] || image.source || '-';
        }
        
        // Update Rating Stars
        function updateRatingStars(rating) {
            const stars = document.querySelectorAll('.star');
            const ratingText = document.getElementById('rating-text');
            
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
            
            if (ratingText) {
                ratingText.textContent = rating > 0 ? `${rating} von 5 Sternen` : 'Keine Bewertung';
            }
        }
        
        // Update Flag Buttons
        function updateFlagButtons(flag) {
            const flagButtons = document.querySelectorAll('.flag-btn');
            flagButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.flag === flag) {
                    btn.classList.add('active');
                }
            });
        }
        
        // Display Comments
        function displayComments(imageId) {
            const commentList = document.getElementById('comment-list');
            const comments = feedbackData.comments[imageId] || [];
            
            commentList.innerHTML = '';
            
            if (comments.length === 0) {
                commentList.innerHTML = '<p style="color: #888; font-size: 0.75em; margin: 0;">Noch keine Kommentare</p>';
                return;
            }
            
            comments.forEach(comment => {
                const commentItem = document.createElement('div');
                commentItem.className = 'comment-item';
                commentItem.innerHTML = `
                    <div class="comment-author">${comment.author || 'Anonym'}</div>
                    <div class="comment-text">${comment.text}</div>
                    <div class="comment-date">${new Date(comment.date).toLocaleString('de-CH')}</div>
                `;
                commentList.appendChild(commentItem);
            });
        }
        
        // Display Selections
        function displaySelections(imageId) {
            const selectionsDiv = document.getElementById('current-selections');
            const selections = feedbackData.selections[imageId] || [];
            
            if (selections.length === 0) {
                selectionsDiv.innerHTML = '<p style="color: #888; font-size: 0.75em; margin: 0;">Nicht in einer Auswahl</p>';
            } else {
                selectionsDiv.innerHTML = selections.map(s => `<span style="background: rgba(102, 126, 234, 0.3); color: #ffffff; padding: 4px 8px; border-radius: 4px; margin-right: 5px; margin-bottom: 5px; display: inline-block; font-size: 0.8em; font-weight: 500; border: 1px solid rgba(102, 126, 234, 0.5);">üìÅ ${s}</span>`).join('');
            }
        }
        
        // Toggle Sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('feedback-sidebar');
            sidebar.classList.toggle('open');
        }
        
        // Add Comment
        function addComment() {
            const image = currentImages[currentImageIndex];
            if (!image) return;
            
            const imageId = image.id || `img_${currentImageIndex}`;
            const commentInput = document.getElementById('comment-input');
            const text = commentInput.value.trim();
            
            if (!text) {
                alert('Bitte geben Sie einen Kommentar ein');
                return;
            }
            
            if (!feedbackData.comments[imageId]) {
                feedbackData.comments[imageId] = [];
            }
            
            feedbackData.comments[imageId].push({
                author: 'Kunde', // K√∂nnte sp√§ter aus localStorage kommen
                text: text,
                date: new Date().toISOString()
            });
            
            saveFeedbackData();
            commentInput.value = '';
            displayComments(imageId);
            updateAllImageBadges();
            
            // Update Kommentar-Z√§hler in Gallery
            const item = document.querySelector(`[data-image-id="${imageId}"]`);
            if (item) {
                const commentBtn = item.querySelector('.gallery-item-actions .gallery-item-btn:last-child');
                if (commentBtn) {
                    const count = feedbackData.comments[imageId].length;
                    commentBtn.innerHTML = `<span>üí¨</span> <span>${count}</span>`;
                }
            }
        }
        
        // Add to Selection
        function addToSelection() {
            const image = currentImages[currentImageIndex];
            if (!image) return;
            
            const imageId = image.id || `img_${currentImageIndex}`;
            const selectionName = document.getElementById('selection-name').value.trim();
            
            if (!selectionName) {
                alert('Bitte geben Sie einen Auswahl-Namen ein');
                return;
            }
            
            if (!feedbackData.selections[imageId]) {
                feedbackData.selections[imageId] = [];
            }
            
            if (!feedbackData.selections[imageId].includes(selectionName)) {
                feedbackData.selections[imageId].push(selectionName);
                saveFeedbackData();
                document.getElementById('selection-name').value = '';
                displaySelections(imageId);
                updateAllImageBadges();
                updateSidebarStats();
            }
        }
        
        // Set Rating
        function setRating(rating) {
            const image = currentImages[currentImageIndex];
            if (!image) return;
            
            const imageId = image.id || `img_${currentImageIndex}`;
            feedbackData.ratings[imageId] = rating;
            saveFeedbackData();
            updateRatingStars(rating);
        }
        
        // Set Flag
        function setFlag(flag) {
            const image = currentImages[currentImageIndex];
            if (!image) return;
            
            const imageId = image.id || `img_${currentImageIndex}`;
            
            // Toggle: Wenn bereits gesetzt, entfernen
            if (feedbackData.flags[imageId] === flag) {
                delete feedbackData.flags[imageId];
            } else {
                feedbackData.flags[imageId] = flag;
            }
            
            saveFeedbackData();
            updateFlagButtons(feedbackData.flags[imageId] || null);
            updateAllImageBadges();
            updateSidebarStats();
            
            // Filter neu anwenden (falls Flag-Filter aktiv)
            if (currentFilter.flag) {
                applyFilter();
            }
        }
        
        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
        }
        
        function nextImage() {
            currentImageIndex = (currentImageIndex + 1) % currentImages.length;
            const image = currentImages[currentImageIndex];
            const imageUrl = image.url || `./images/${image.name}`;
            document.getElementById('lightbox-image').src = imageUrl;
            updateFeedbackSidebar();
        }
        
        function previousImage() {
            currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
            const image = currentImages[currentImageIndex];
            const imageUrl = image.url || `./images/${image.name}`;
            document.getElementById('lightbox-image').src = imageUrl;
            updateFeedbackSidebar();
        }
        
        async function downloadImage() {
            const image = currentImages[currentImageIndex];
            const imageUrl = image.url || `./images/${image.name}`;
            const fileName = image.name || 'image.jpg';
            
            try {
                // F√ºr Cloudinary-URLs: Lade Bild als Blob und starte Download
                if (imageUrl.includes('res.cloudinary.com')) {
                    // Entferne Transformationen f√ºr Original-Download
                    let downloadUrl = imageUrl;
                    // Entferne Transformationen aus der URL um Original zu bekommen
                    if (downloadUrl.includes('/upload/')) {
                        // Finde die Version/Public ID nach den Transformationen
                        const match = downloadUrl.match(/\/upload\/[^\/]+\/(v\d+\/)?([^\/]+)$/);
                        if (match) {
                            // Erstelle URL ohne Transformationen (Original)
                            const cloudName = downloadUrl.match(/res\.cloudinary\.com\/([^\/]+)/)?.[1];
                            const version = match[1] || '';
                            const publicId = match[2];
                            downloadUrl = `https://res.cloudinary.com/${cloudName}/image/upload/${version}${publicId}`;
                        }
                    }
                    
                    // Lade Bild als Blob
                    const response = await fetch(downloadUrl);
                    if (!response.ok) {
                        throw new Error('Bild konnte nicht geladen werden');
                    }
                    
                    const blob = await response.blob();
                    const blobUrl = window.URL.createObjectURL(blob);
                    
                    // Erstelle Download-Link
                    const link = document.createElement('a');
                    link.href = blobUrl;
                    link.download = fileName;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // Cleanup
                    window.URL.revokeObjectURL(blobUrl);
                } else {
                    // F√ºr lokale Bilder: Direkter Download
                    const link = document.createElement('a');
                    link.href = imageUrl;
                    link.download = fileName;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            } catch (error) {
                console.error('Download-Fehler:', error);
                // Fallback: √ñffne in neuem Tab
                window.open(imageUrl, '_blank');
            }
        }
        
        // Tastatur-Navigation
        document.addEventListener('keydown', (e) => {
            const lightbox = document.getElementById('lightbox');
            if (lightbox.classList.contains('active')) {
                if (e.key === 'Escape') closeLightbox();
                if (e.key === 'ArrowRight') nextImage();
                if (e.key === 'ArrowLeft') previousImage();
            }
        });
        
        // Initialisierung
        (async () => {
            // Theme initialisieren
            initTheme();
            
            // Suche initialisieren
            initSearch();
            
            await loadConfig();
            
            if (!galleryConfig) {
                document.getElementById('error').style.display = 'block';
                return;
            }
            
            // Pr√ºfe ob mehrere Galerien vorhanden sind
            console.log('Galerien gefunden:', galleryConfig.galleries?.length || 0);
            if (galleryConfig.galleries && galleryConfig.galleries.length > 0) {
                // Zeige immer Galerie-Auswahl (auch bei nur einer Galerie)
                console.log('Zeige Galerie-Auswahl');
                showGallerySelector();
            } else {
                // Fallback: Alte Struktur (nur images Array)
                if (galleryConfig.images && galleryConfig.images.length > 0) {
                    // Konvertiere alte Struktur zu neuer
                    currentImages = galleryConfig.images;
                    document.getElementById('gallery-container').style.display = 'block';
                    displayGallery(currentImages);
                } else {
                    document.getElementById('error').style.display = 'block';
                }
            }
        })();
    </script>
</body>
</html>
